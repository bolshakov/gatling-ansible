---

- name: Run Gatling
  docker_container:
    name: gatling-load
    image: "{{ gatling_docker_image }}"
    state: started
    detach: false # By default this is true
    restart: true
    network_mode: host
    command:
      - --no-reports
      - --simulations-folder /gatling/user-files/simulations
      - --simulation computerdatabase.BasicSimulation
    volumes:
      - /tmp/gatling/results:/gatling/results

- name: Rename /tmp/gatling/results-{timustamp} to /tmp/gatling/results/results
  shell: ls -t /tmp/gatling/results | head -n 1 | xargs -I {} mv /tmp/gatling/results/{} /tmp/gatling/results/results/
- name: Copy results
  fetch:
    src: /tmp/gatling/results/results/simulation.log
    dest: "./results/simulation-{{ inventory_hostname }}.log"
    flat: true

